# Warning

**The C parser, code-generator, and SDL desktop player
are incomplete and no longer updated.
Use the Rust implementation for a more complete feature set.**

# C Setup
- (Optional) Set up [clangd](https://clangd.llvm.org/) for your editor/IDE.
  I use [vscode-clangd](https://github.com/clangd/vscode-clangd) with
  [VSCodium](https://vscodium.com/).
  The Arduino build process will still use  `avr-gcc` from `arduino-cli`
  (see next step), `clangd` is just for language support in the editor.
  In order for the build scripts to generate valid and complete
  `compile_commands.json` compilation databases (using `-MJ`),
  `clang` is required.
- (for Arduino support) Install
  [arduino-cli](https://arduino.github.io/arduino-cli/0.19/installation/).
  This is necessary for the build scripts.
  Personally, I downloaded the archive, extracted it to a directory, and
  added `arduino-cli` to my `PATH` environment variable.
  Alternatively, you could use the
  [Arduino IDE](https://www.arduino.cc/en/software),
  [Arduino-Makefile](https://github.com/sudar/Arduino-Makefile),
  or something else.
  - Install the necessary files for your board. For my Arduino Uno, I had
    to run:

    `arduino-cli config init`

    `arduino-cli core update-index`

    `arduino-cli core install arduino:avr`
- (for desktop player) Install `clang` and the SDL2 library.
  On Debian-based systems, this is done via
  `sudo apt-get install clang libsdl2-dev`.

# Usage of C Implementation

## `make <file.abc>`

Run the parser on a file.
This generates a C header file (`out/out.h`) containing an optimized
representation of the song.

## `make build_arduino`

Build the program for an Arduino Uno.
Uses the song-header in `out/out.h` (which can be generated by either the
Rust or C implementation).

## `make upload_arduino`

Attempt to upload the built program to **every device in /dev/ttyACM\***.
This is done because (on my machine, at least) power-cycling an Arduino may
change its device file between `ttyACM0` and `ttyACM1`.

## `make desktop`

Build the parser and desktop player.
This will create the executable `build/desktop/parse`.

Building the player requires SDL2.
